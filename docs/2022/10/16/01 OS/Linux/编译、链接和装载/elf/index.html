<!DOCTYPE html>
<html lang="en">

<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
	
	<!-- title -->
	
	<title>
	
		Elf文件格式 | 
	 
	LeahGe
	</title>
	
	<!-- keywords,description -->
	 

	<!-- favicon -->
	
	<link rel="shortcut icon" href="/favicon.ico">
	


	<!-- search -->
	<script>
		var searchEngine = "https://www.google.com/search?q=";
		if(typeof searchEngine == "undefined" || searchEngine == null || searchEngine == ""){
			searchEngine = "https://www.google.com/search?q=";
		}
		var homeHost = "leahge.github.io";
		if(typeof homeHost == "undefined" || homeHost == null || homeHost == ""){
			homeHost = window.location.host;
		}
	</script>


	
<link rel="stylesheet" href="/css/main.css">

	
<link rel="stylesheet" href="https://cdn.staticfile.org/font-awesome/4.7.0/css/font-awesome.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/styles/darcula.min.css">

	
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.css">


	
<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/fancyapps/fancybox@3.5.7/dist/jquery.fancybox.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@9.17.1/build/highlight.min.js"></script>

	
<script src="https://cdn.jsdelivr.net/npm/jquery-pjax@2.0.1/jquery.pjax.min.js"></script>

	
<script src="/js/main.js"></script>

	
		
<script src="https://cdn.jsdelivr.net/npm/leancloud-storage/dist/av-min.js"></script>

		
<script src="https://cdn.jsdelivr.net/npm/valine@v1.4.14/dist/Valine.min.js"></script>

	
	
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
	<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?3efe99c287df5a1d6f0d02d187e403c1";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>

<header id="header">
    <a id="title" href="/" class="logo">LeahGe</a>

	<ul id="menu">
		<li class="menu-item">
			<a href="/about" class="menu-item-link">ABOUT</a>
		</li>
	

	

		<li class="menu-item">
			<a href="https://github.com/leahge" class="menu-item-link" target="_blank">
				<i class="fa fa-github fa-2x"></i>
			</a>
		</li>
	</ul>
</header>

	
<div id="sidebar">
	<button id="sidebar-toggle" class="toggle" ><i class="fa fa-arrow-right " aria-hidden="true"></i></button>
	
	<div id="site-toc">
		<input id="search-input" class="search-input" type="search" placeholder="按回车全站搜索">
		<div id="tree">
			

			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										01 OS
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Linux
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Kernel
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/10/16/01%20OS/Linux/Kernel/kallsyms/">
                     
										    Kallsyms
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Perf
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/Perf/perf-report/">
                     
										    Perf-Report(1) — Linux Manual Page
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/Perf/perf-script/">
                     
										    Perf-Script(1) — Linux Manual Page
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/Perf/perf-stat/">
                     
										    Perf-Stat(1)
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/28/01%20OS/Linux/Perf/perf_event/">
                     
										    PMU计数器
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/Perf/perf_hardware/">
                     
										    PERF EVENT 硬件篇
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/Perf/perf_hardware2/">
                     
										    PERF EVENT 硬件篇续篇
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/Perf/perf_ipc/">
                     
										    Perf IPC以及CPU利用率
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/Perf/perf_kernel/">
                     
										    PERF EVENT 内核篇
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/14/01%20OS/Linux/Perf/%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/">
                     
										    参考资料
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Shell
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/10/27/01%20OS/Linux/Shell/stringcut/">
                     
										    Shell字符串截取
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										network
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/10/27/01%20OS/Linux/network/irq/">
                     
										    网卡多队列配置和中断绑定
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										指令
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/%E6%8C%87%E4%BB%A4/df/">
                     
										    Df(1)
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/%E6%8C%87%E4%BB%A4/du/">
                     
										    Du(1)
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/%E6%8C%87%E4%BB%A4/ftrace/">
                     
										    Ftrace
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/%E6%8C%87%E4%BB%A4/ltrace/">
                     
										    Ltrace(1) — Linux Manual Page
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/%E6%8C%87%E4%BB%A4/man_class/">
                     
										    Linux指令后的数字代表什么
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/%E6%8C%87%E4%BB%A4/mpstat/">
                     
										    Mpstat-Multiprocessor Statistics
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/%E6%8C%87%E4%BB%A4/pidstat/">
                     
										    Pidstat
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/%E6%8C%87%E4%BB%A4/sadc/">
                     
										    Sadc(8) — Linux Manual Page
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/27/01%20OS/Linux/%E6%8C%87%E4%BB%A4/sar/">
                     
										    Sar
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/14/01%20OS/Linux/%E6%8C%87%E4%BB%A4/sed/">
                     
										    Sed
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/%E6%8C%87%E4%BB%A4/strace/">
                     
										    Strace
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/Linux/%E6%8C%87%E4%BB%A4/vmstat/">
                     
										    Vmstat-Report Virtual Memory Statistics
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										系统调用
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/10/16/01%20OS/Linux/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/brk/">
                     
										    Brk
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/16/01%20OS/Linux/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/exec/">
                     
										    Exec
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/16/01%20OS/Linux/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/futex/">
                     
										    Futex
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/16/01%20OS/Linux/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/getcpu/">
                     
										    Getcpu系统调用
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/16/01%20OS/Linux/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/gettimeofday/">
                     
										    Gettimeofday
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/16/01%20OS/Linux/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/ioctl/">
                     
										    Ioctl
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/16/01%20OS/Linux/%E7%B3%BB%E7%BB%9F%E8%B0%83%E7%94%A8/mmap/">
                     
										    Mmap
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										编译、链接和装载
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/10/16/01%20OS/Linux/%E7%BC%96%E8%AF%91%E3%80%81%E9%93%BE%E6%8E%A5%E5%92%8C%E8%A3%85%E8%BD%BD/DSO/">
                     
										    DSO(dynamic Shared Object)动态共享对象的原理
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/27/01%20OS/Linux/%E7%BC%96%E8%AF%91%E3%80%81%E9%93%BE%E6%8E%A5%E5%92%8C%E8%A3%85%E8%BD%BD/compile_Link/">
                     
										    Linux下编译、链接和装载
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file active">
									<a href="/2022/10/16/01%20OS/Linux/%E7%BC%96%E8%AF%91%E3%80%81%E9%93%BE%E6%8E%A5%E5%92%8C%E8%A3%85%E8%BD%BD/elf/">
                     
										    Elf文件格式
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/14/01%20OS/Linux/%E7%BC%96%E8%AF%91%E3%80%81%E9%93%BE%E6%8E%A5%E5%92%8C%E8%A3%85%E8%BD%BD/linux_compile/">
                     
										    编译、链接和装载
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										进程
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/10/28/01%20OS/Linux/%E8%BF%9B%E7%A8%8B/status/">
                     
										    Linux进程状态：S 和D状态
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/01%20OS/%E6%9C%8D%E5%8A%A1%E5%99%A8BMC%E4%B8%8EIPMI%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">
                     
										    服务器BMC与IPMI基础知识
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										02 CPU
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/10/14/02%20CPU/SocketNodeDieCoreProcessor/">
                     
										    Socket/Node/Die/Core/Processor/Package
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/14/02%20CPU/%E6%8A%80%E6%9C%AF%E5%8F%91%E5%B1%95/">
                     
										    技术发展
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										50 soft
									</a>
									
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										Nodejs
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/10/14/50%20soft/Nodejs/npm/">
                     
										    Npm
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="directory">
									<a href="#" class="directory">
										<i class="fa fa-plus-square-o"></i>
										99 Other
									</a>
									
							<ul>
								<li class="file">
									<a href="/2022/10/13/99%20Other/%E5%9B%BE%E7%81%B5%E6%9C%BA%E4%B8%8E%E5%9B%BE%E7%81%B5%E5%AE%8C%E5%A4%87/">
                     
										    图灵机与图灵完备
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
								</li>
								
							</ul>
			
							<ul>
								<li class="file">
									<a href="/2022/10/13/ebook/">
                     
										    99 Ebook
                     
									</a>
								</li>
								<div class="article-toc" style="display: none;"></div>
							</ul>
			
		</div>
	</div>
</div>

	<!-- 引入正文 -->
	<div id="content">
		<h1 id="article-title">
	Elf文件格式
</h1>
<div class="article-meta">
	
	<span>Leah Ge</span>
	<span>2022-10-16 18:59:05</span>
		<div id="article-categories">
    
		<span>Categories：</span>
            
    

    
		<span>Tags：</span>
            
    
		</div>

</div>

<div id="article-content">
	<h1 id="elf文件格式"><a href="#elf文件格式" class="headerlink" title="elf文件格式"></a>elf文件格式</h1><h2 id="1-简介"><a href="#1-简介" class="headerlink" title="1 简介"></a>1 简介</h2><p>什么是ELF<br>系统里的目标文件是按照特定的目标文件格式来组织的，各个系统的目标文件格式都不相同。</p>
<p>从贝尔实验室诞生的第一个Unix系统使用的是a.out格式（直到今天，可执行文件仍然称为a.out文件）。Windows使用可移植可执行（PortableExecutable，PE)格式。Mac OS-X使用Mach-O格式。现代x86-64Linux和Unix系统使用可执行可链接格式（Executable and Linkable Format，ELF)。</p>
<p>ELF格式的文件在Linux系统下有.axf、 .bin、 .elf、 .o、 .prx、 .puff、 .ko、 .mod和.so等等</p>
<ol>
<li>分类</li>
</ol>
<p>可重定位文件(Relocatable File) .o)包含适合于与其他目标文件链接来创建可执行文件或者共享目标文件的代码和数据。</p>
<p>可执行文件(Executable File) .exe) 包含适合于执行的一个程序，此文件规定了exec() 如何创建一个程序的进程映像。</p>
<p>共享目标文件(Shared Object File) .so) 包含可在两种上下文中链接的代码和数据。</p>
<p>首先链接编辑器可以将它和其它可重定位文件和共享目标文件一起处理， 生成另外一个目标文件。</p>
<p>其次动态链接器(Dynamic Linker)可能将它与某 个可执行文件以及其它共享目标一起组合，创建进程映像。</p>
<ol start="2">
<li>作用</li>
</ol>
<p>ELF文件参与程序的连接(建立一个程序)和程序的执行(运行一个程序)，所以可以从不同的角度来看待elf格式的文件：</p>
<p>如果用于编译和链接（可重定位文件），则编译器和链接器将把elf文件看作是节头表描述的节的集合,程序头表可选。</p>
<p>如果用于加载执行（可执行文件），则加载器则将把elf文件看作是程序头表描述的段的集合，一个段可能包含多个节，节头表可选。</p>
<p>如果是共享文件，则两者都含有。</p>
<ol start="3">
<li>ELF文件总体组成：</li>
</ol>
<p>elf文件头描述elf文件的总体信息。包括：</p>
<p>系统相关，类型相关，加载相关，链接相关。</p>
<p>系统相关表示：elf文件标识的魔术数，以及硬件和平台等相关信息，增加了elf文件的移植性,使交叉编译成为可能。</p>
<p>类型相关就是前面说的那个类型。</p>
<p>加载相关：包括程序头表相关信息。</p>
<p>链接相关：节头表相关信息。</p>
<p>下面对其进行了详细的介绍。</p>
<h2 id="2-ELF文件格式"><a href="#2-ELF文件格式" class="headerlink" title="2 ELF文件格式"></a>2 ELF文件格式</h2><h3 id="典型格式"><a href="#典型格式" class="headerlink" title="典型格式"></a>典型格式</h3><p>典型的ELF可重定位目标文件的格式如下图：<br><img  src="./v2-292d68399317ad971e97443f68dec061_720w.webp" alt=""><br>其中： - .text 节里装载了程序的可执行机器码 - .rodata 节里装载了只读数据 - .data 节里面装载了被初始化的数据，包括全局和静态C变量 - .bss 节里面装载了未被初始化的全局和静态C变量(在目标文件中只是占位符，不占空间) - .symtab 或者 .dynsym 节里面装载了符号信息 - 以 .rel 打头的 节里面装载了重定位条目 - .debug 一个调试符号表，只有使用了-g参数编译时才会有，用于debug - .line 用于记录C源程序的行号和.text节中机器指令之间的映射，也是只有使用了-g参数编译时才会有 - .strtab 或者 .dynstr 节里面装载了字符串信息（以null结尾的字符串信息）</p>
<h3 id="1-ELF文件的组织"><a href="#1-ELF文件的组织" class="headerlink" title="1. ELF文件的组织"></a>1. ELF文件的组织</h3><p>ELF文件参与程序的连接(建立一个程序)和程序的执行(运行一个程序)，编译器和链接器将其视为节头表(section header table)描述的一些节(section)的集合，而加载器则将其视为程序头表(program header table)描述的段(segment)的集合，通常一个段可以包含多个节。可重定位文件都包含一个节头表，可执行文件都包含一个程序头表。共享文件两者都包含有。为此，ELF文件格式同时提供了两种看待文件内容的方式，反映了不同行为的不同要求。</p>
<p>从链接的角度看，ELF文件从开始到结束，可以看成是如下组成的：</p>
<p>a)ELF文件头</p>
<p>b)程序头表（可选）</p>
<p>c)第1节,第2节，…，第n节，…</p>
<p>d)节头表</p>
<p>从执行的角度看，ELF文件从开始到结束，可以看成是如下组成的：</p>
<p>a)ELF文件头</p>
<p>b)程序头表</p>
<p>c)第1段,第2段，…，</p>
<p>d)节头表(可选)</p>
<h3 id="2-文件头-Elf-header"><a href="#2-文件头-Elf-header" class="headerlink" title="2. 文件头(Elf header)"></a>2. 文件头(Elf header)</h3><p>Elf头在程序的开始部位，作为引路表描述整个ELF的文件结构，其信息大致分为四部分：一是系统相关信息，二是目标文件类型，三是加载相关信息，四是链接相关信息。</p>
<p>其中系统相关信息包括elf文件魔数(标识elf文件)，平台位数，数据编码方式，elf头部版本，硬件平台e_machine，目标文件版本 e_version，处理器特定标志e_ftags：这些信息的引入极大增强了elf文件的可移植性，使交叉编译成为可能。目标文件类型用e_type的值表示，可重定位文件为1，可执行文件为2，共享文件为3;加载相关信息有：程序进入点e_entry．程序头表偏移量e_phoff，elf头部长度 e_ehsize，程序头表中一个条目的长度e_phentsize，程序头表条目数目e_phnum;链接相关信息有：节头表偏移量e_shoff，节头表中一个条目的长度e_shentsize，节头表条目个数e_shnum ，节头表字符索引e shstmdx。可使用命令”readelf -h filename”来察看文件头的内容。</p>
<p>文件头的数据结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">typedef struct elf32_hdr&#123;</span><br><span class="line"></span><br><span class="line">unsigned char e_ident[EI_NIDENT];</span><br><span class="line"></span><br><span class="line">Elf32_Half e_type;//目标文件类型</span><br><span class="line"></span><br><span class="line">Elf32_Half e_machine;//硬件平台</span><br><span class="line"></span><br><span class="line">Elf32_Word e_version;//elf头部版本</span><br><span class="line"></span><br><span class="line">Elf32_Addr e_entry;//程序进入点</span><br><span class="line"></span><br><span class="line">Elf32_Off e_phoff;//程序头表偏移量</span><br><span class="line"></span><br><span class="line">Elf32_Off e_shoff;//节头表偏移量</span><br><span class="line"></span><br><span class="line">Elf32_Word e_flags;/处理器特定标志</span><br><span class="line"></span><br><span class="line">Elf32_Half e_ehsize;//elf头部长度</span><br><span class="line"></span><br><span class="line">Elf32_Half e_phentsize;//程序头表中一个条目的长度</span><br><span class="line"></span><br><span class="line">Elf32_Half e_phnum;//程序头表条目数目</span><br><span class="line"></span><br><span class="line">Elf32_Half e_shentsize;//节头表中一个条目的长度</span><br><span class="line"></span><br><span class="line">Elf32_Half e_shnum;//节头表条目个数</span><br><span class="line"></span><br><span class="line">Elf32_Half e_shstrmdx;//节头表字符索引</span><br><span class="line"></span><br><span class="line">&#125;Elf32_Ehdr;</span><br></pre></td></tr></table></figure>


<h3 id="3-程序头表-program-header-table"><a href="#3-程序头表-program-header-table" class="headerlink" title="3. 程序头表(program header table)"></a>3. 程序头表(program header table)</h3><p>程序头表告诉系统如何建立一个进程映像．它是从加载执行的角度来看待elf文件．从它的角度看．elf文件被分成许多段，elf文件中的代码、链接信息和注释都以段的形式存放。每个段都在程序头表中有一个表项描述，包含以下属性：段的类型，段的驻留位置相对于文件开始处的偏移，段在内存中的首字节地址，段的物理地址，段在文件映像中的字节数．段在内存映像中的字节数，段在内存和文件中的对齐标记。可用”readelf -l filename”察看程序头表中的内容。程序头表的结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">typedef struct elf32_phdr&#123;</span><br><span class="line"></span><br><span class="line">Elf32_Word p_type; //段的类型</span><br><span class="line"></span><br><span class="line">Elf32_Off p_offset; //段的位置相对于文件开始处的偏移</span><br><span class="line"></span><br><span class="line">Elf32_Addr p_vaddr; //段在内存中的首字节地址</span><br><span class="line"></span><br><span class="line">Elf32_Addr p_paddr;//段的物理地址</span><br><span class="line"></span><br><span class="line">Elf32_Word p_filesz;//段在文件映像中的字节数</span><br><span class="line"></span><br><span class="line">Elf32_Word p_memsz;//段在内存映像中的字节数</span><br><span class="line"></span><br><span class="line">Elf32_Word p_flags;//段的标记</span><br><span class="line"></span><br><span class="line">Elf32_Word p_align;，/段在内存中的对齐标记</span><br><span class="line"></span><br><span class="line">)Elf32_Phdr;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="4-节头表-section-header-table"><a href="#4-节头表-section-header-table" class="headerlink" title="4. 节头表(section header table)"></a>4. 节头表(section header table)</h3><p>节头表描述程序节，为编译器和链接器服务。它把elf文件分成了许多节．每个节保存着用于不同目的的数据．这些数据可能被前面的程序头重复使用，完成一次任务所需的信息往往被分散到不同的节里。由于节中数据的用途不同，节被分成不同的类型，每种类型的节都有自己组织数据的方式。每一个节在节头表中都有一个表项描述该节的属性，节的属性包括小节名在字符表中的索引，类型，属性，运行时的虚拟地址，文件偏移，以字节为单位的大小，小节的对齐等信息，可使用”readelf -S filename”来察看节头表的内容。节头表的结构如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">typedef struct&#123;</span><br><span class="line"></span><br><span class="line">Elf32_Word sh_name;//小节名在字符表中的索引</span><br><span class="line"></span><br><span class="line">E1t32_Word sh_type;//小节的类型</span><br><span class="line"></span><br><span class="line">Elf32_Word sh_flags;//小节属性</span><br><span class="line"></span><br><span class="line">Elf32_Addr sh_addr; //小节在运行时的虚拟地址</span><br><span class="line"></span><br><span class="line">Elf32_Off sh_offset;//小节的文件偏移</span><br><span class="line"></span><br><span class="line">Elf32_Word sh_size;//小节的大小．以字节为单位</span><br><span class="line"></span><br><span class="line">Elf32_Word sh_link;//链接的另外一小节的索引</span><br><span class="line"></span><br><span class="line">Elf32 Word sh_info;//附加的小节信息</span><br><span class="line"></span><br><span class="line">Elf32 Word sh_addralign;//小节的对齐</span><br><span class="line"></span><br><span class="line">Elf32 Word sh_entsize; //一些sections保存着一张固定大小入口的表。就像符号表</span><br><span class="line"></span><br><span class="line">&#125;Elf32_Shdr;</span><br></pre></td></tr></table></figure>

<h3 id="5-符号表部分解析"><a href="#5-符号表部分解析" class="headerlink" title="5. 符号表部分解析"></a>5. 符号表部分解析</h3><p>符号表每节定义如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">typedef struct &#123;</span><br><span class="line">    int   name;      /* String table offset */</span><br><span class="line">    char  type:4,    /* Function or data (4 bits) */</span><br><span class="line">      binding:4; /* Local or global (4 bits) */</span><br><span class="line">    char  reserved;  /* Unused */  </span><br><span class="line">    short section;   /* Section header index */</span><br><span class="line">    long  value;     /* Section offset or absolute address */</span><br><span class="line">    long  size;      /* Object size in bytes */</span><br><span class="line">&#125; Elf64_Symbol;</span><br></pre></td></tr></table></figure>
<p>具体解释如下：<br><img  src="./v2-9889a20d2f4af62998913baf6e890ef5_720w.jpeg" alt=""></p>
<p>举个例子<br>以上面的sum.c生成的sum.o为例，我们选取readelf的-all参数输出全部内容：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line">$readelf -all sum.o</span><br><span class="line">ELF Header:</span><br><span class="line">  Magic:   7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00</span><br><span class="line">  Class:                             ELF64</span><br><span class="line">  Data:                              2&#x27;s complement, little endian</span><br><span class="line">  Version:                           1 (current)</span><br><span class="line">  OS/ABI:                            UNIX - System V</span><br><span class="line">  ABI Version:                       0</span><br><span class="line">  Type:                              REL (Relocatable file)</span><br><span class="line">  Machine:                           Advanced Micro Devices X86-64</span><br><span class="line">  Version:                           0x1</span><br><span class="line">  Entry point address:               0x0</span><br><span class="line">  Start of program headers:          0 (bytes into file)</span><br><span class="line">  Start of section headers:          536 (bytes into file)</span><br><span class="line">  Flags:                             0x0</span><br><span class="line">  Size of this header:               64 (bytes)</span><br><span class="line">  Size of program headers:           0 (bytes)</span><br><span class="line">  Number of program headers:         0</span><br><span class="line">  Size of section headers:           64 (bytes)</span><br><span class="line">  Number of section headers:         11</span><br><span class="line">  Section header string table index: 10</span><br><span class="line"></span><br><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type             Address           Offset</span><br><span class="line">       Size              EntSize          Flags  Link  Info  Align</span><br><span class="line">  [ 0]                   NULL             0000000000000000  00000000</span><br><span class="line">       0000000000000000  0000000000000000           0     0     0</span><br><span class="line">  [ 1] .text             PROGBITS         0000000000000000  00000040</span><br><span class="line">       000000000000001b  0000000000000000  AX       0     0     1</span><br><span class="line">  [ 2] .data             PROGBITS         0000000000000000  0000005b</span><br><span class="line">       0000000000000000  0000000000000000  WA       0     0     1</span><br><span class="line">  [ 3] .bss              NOBITS           0000000000000000  0000005b</span><br><span class="line">       0000000000000000  0000000000000000  WA       0     0     1</span><br><span class="line">  1 int sum(int *a, int n)</span><br><span class="line">  2 &#123;</span><br><span class="line">  [ 4] .comment          PROGBITS         0000000000000000  0000005b</span><br><span class="line">       000000000000002e  0000000000000001  MS       0     0     1</span><br><span class="line">  [ 5] .note.GNU-stack   PROGBITS         0000000000000000  00000089</span><br><span class="line">       0000000000000000  0000000000000000           0     0     1</span><br><span class="line">  [ 6] .eh_frame         PROGBITS         0000000000000000  00000090</span><br><span class="line">       0000000000000030  0000000000000000   A       0     0     8</span><br><span class="line">  [ 7] .rela.eh_frame    RELA             0000000000000000  000001a8</span><br><span class="line">       0000000000000018  0000000000000018   I       8     6     8</span><br><span class="line">  [ 8] .symtab           SYMTAB           0000000000000000  000000c0</span><br><span class="line">       00000000000000d8  0000000000000018           9     8     8</span><br><span class="line">  [ 9] .strtab           STRTAB           0000000000000000  00000198</span><br><span class="line">       000000000000000b  0000000000000000           0     0     1</span><br><span class="line">  [10] .shstrtab         STRTAB           0000000000000000  000001c0</span><br><span class="line">       0000000000000054  0000000000000000           0     0     1</span><br><span class="line">Key to Flags:</span><br><span class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),</span><br><span class="line">  L (link order), O (extra OS processing required), G (group), T (TLS),</span><br><span class="line">  C (compressed), x (unknown), o (OS specific), E (exclude),</span><br><span class="line">  l (large), p (processor specific)</span><br><span class="line"></span><br><span class="line">There are no section groups in this file.</span><br><span class="line"></span><br><span class="line">There are no program headers in this file.</span><br><span class="line"></span><br><span class="line">Relocation section &#x27;.rela.eh_frame&#x27; at offset 0x1a8 contains 1 entries:</span><br><span class="line">  Offset          Info           Type           Sym. Value    Sym. Name + Addend</span><br><span class="line">000000000020  000200000002 R_X86_64_PC32     0000000000000000 .text + 0</span><br><span class="line"></span><br><span class="line">The decoding of unwind sections for machine type Advanced Micro Devices X86-64 is not currently supported.</span><br><span class="line"></span><br><span class="line">Symbol table &#x27;.symtab&#x27; contains 9 entries:</span><br><span class="line">   Num:    Value          Size Type    Bind   Vis      Ndx Name</span><br><span class="line">     0: 0000000000000000     0 NOTYPE  LOCAL  DEFAULT  UND</span><br><span class="line">     1: 0000000000000000     0 FILE    LOCAL  DEFAULT  ABS sum.i</span><br><span class="line">     2: 0000000000000000     0 SECTION LOCAL  DEFAULT    1</span><br><span class="line">     3: 0000000000000000     0 SECTION LOCAL  DEFAULT    2</span><br><span class="line">     4: 0000000000000000     0 SECTION LOCAL  DEFAULT    3</span><br><span class="line">     5: 0000000000000000     0 SECTION LOCAL  DEFAULT    5</span><br><span class="line">     6: 0000000000000000     0 SECTION LOCAL  DEFAULT    6</span><br><span class="line">     7: 0000000000000000     0 SECTION LOCAL  DEFAULT    4</span><br><span class="line">     8: 0000000000000000    27 FUNC    GLOBAL DEFAULT    1 sum</span><br><span class="line"></span><br><span class="line">No version information found in this file.</span><br></pre></td></tr></table></figure>
<p>其中第一部分是ELF头（ELF header）中的描述信息。（用-h参数可以单独得到）。</p>
<p>最后一部分是符号表部分（用-s参数可以单独得到该部分），前面八个条目是链接器内部使用的局部符号，最后一行是全局符号sum定义的条目。可以通过最后一行看出，它是一个位于.text节中偏移量为0处的27字节函数。（Ndx部分表示在哪个节中，1表示.text节，3表示.data节，对应上面输出的Section Headers部分）</p>
<h3 id="6-节与静态链接"><a href="#6-节与静态链接" class="headerlink" title="6. 节与静态链接"></a>6. 节与静态链接</h3><p>常规的 ELF 文件，ET_REL, ET_DYN 以及 ET_EXEC 类型都含有节，对于 ET_REL 类型 的ELF文件，节是必须存在的，而对于 ET_DYN 和 ET_EXEC 是可以没有节的，但由于Linux系统的版本碎片化比较严重，可执行文件也可能要求含有节，否则无法执行（如安卓后期版本的系统），这依赖于系统动态链接器的实现。</p>
<p>ET_REL 类型的 ELF，节中包含了一些符号定义、节属性（可读可写可执行）。通过 readelf 工具可以方便查看这些信息：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$readelf test.o -S</span><br><span class="line">There are 15 section headers, starting at offset 0x2e0:</span><br><span class="line"></span><br><span class="line">Section Headers:</span><br><span class="line">  [Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al</span><br><span class="line">  [ 0]                   NULL            00000000 000000 000000 00      0   0  0</span><br><span class="line">  [ 1] .group            GROUP           00000000 000034 000008 04     12  12  4</span><br><span class="line">  [ 2] .text             PROGBITS        00000000 00003c 000032 00  AX  0   0  1</span><br><span class="line">  [ 3] .rel.text         REL             00000000 00022c 000020 08   I 12   2  4</span><br><span class="line">  [ 4] .data             PROGBITS        00000000 00006e 000000 00  WA  0   0  1</span><br><span class="line">  [ 5] .bss              NOBITS          00000000 00006e 000000 00  WA  0   0  1</span><br><span class="line">  [ 6] .rodata           PROGBITS        00000000 00006e 00000b 00   A  0   0  1</span><br><span class="line">  [ 7] .text.__x86.get_p PROGBITS        00000000 000079 000004 00 AXG  0   0  1</span><br><span class="line">  [ 8] .comment          PROGBITS        00000000 00007d 00002c 01  MS  0   0  1</span><br><span class="line">  [ 9] .note.GNU-stack   PROGBITS        00000000 0000a9 000000 00      0   0  1</span><br><span class="line">  [10] .eh_frame         PROGBITS        00000000 0000ac 000050 00   A  0   0  4</span><br><span class="line">  [11] .rel.eh_frame     REL             00000000 00024c 000010 08   I 12  10  4</span><br><span class="line">  [12] .symtab           SYMTAB          00000000 0000fc 0000f0 10     13  11  4</span><br><span class="line">  [13] .strtab           STRTAB          00000000 0001ec 00003e 00      0   0  1</span><br><span class="line">  [14] .shstrtab         STRTAB          00000000 00025c 000082 00      0   0  1</span><br><span class="line">Key to Flags:</span><br><span class="line">  W (write), A (alloc), X (execute), M (merge), S (strings), I (info),</span><br><span class="line">  L (link order), O (extra OS processing required), G (group), T (TLS),</span><br><span class="line">  C (compressed), x (unknown), o (OS specific), E (exclude),</span><br><span class="line">  p (processor specific)</span><br></pre></td></tr></table></figure>
<p>以上readelf 对一个 .o 文件 （ET_REL类型） 的输出，其中 .text 段中存放可执行的代码，.data 中存放数据（如全局变量，静态变量等），.rodata 存放了常量数据（如字符串等），.bss 中存放未初始化或初始化为零的数据，本节将介绍这些细节。</p>
<h4 id="节表"><a href="#节表" class="headerlink" title="节表"></a><strong>节表</strong></h4><p>节表是节头（Section Header）数组，位置和个数由 Elf_Ehdr 的 e_shoff 和 e_shnum 指定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Elf_Shdr* shdrs = (Elf_Shdr*)(elf_data + ehdr-&gt;e_shoff);</span><br><span class="line">Elf_Half scnt = elf-&gt;e_shnum;</span><br></pre></td></tr></table></figure>
<p>节头包含了节名称，节属性，文件偏移等内容，定义如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">/* Section header.  */</span><br><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  Elf_Word	sh_name;		/* Section name (string tbl index) */</span><br><span class="line">  Elf_Word	sh_type;		/* Section type */</span><br><span class="line">  Elf_Word	sh_flags;		/* Section flags */</span><br><span class="line">  Elf_Addr	sh_addr;		/* Section virtual addr at execution */</span><br><span class="line">  Elf_Off	sh_offset;		/* Section file offset */</span><br><span class="line">  Elf_Word	sh_size;		/* Section size in bytes */</span><br><span class="line">  Elf_Word	sh_link;		/* Link to another section */</span><br><span class="line">  Elf_Word	sh_info;		/* Additional section information */</span><br><span class="line">  Elf_Word	sh_addralign;		/* Section alignment */</span><br><span class="line">  Elf_Word	sh_entsize;		/* Entry size if section holds table */</span><br><span class="line">&#125; Elf_Shdr;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h5 id="sh-name"><a href="#sh-name" class="headerlink" title="sh_name"></a><strong>sh_name</strong></h5><p>节名称，这是一个节字符串表的偏移，节字符串的索引在 Elf_Ehdr 的 e_shstrndx 中指定。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const char* sname = (const char*)(elf_data +</span><br><span class="line">	shdr[elf-&gt;e_shstrndx].sh_offset);</span><br></pre></td></tr></table></figure>
<h5 id="sh-type"><a href="#sh-type" class="headerlink" title="sh_type"></a><strong>sh_type</strong></h5><p>节类型，以下为 ET_REL 常见的节类型定义：</p>
<table>
<thead>
<tr>
<th>节类型</th>
<th>节描述</th>
</tr>
</thead>
<tbody><tr>
<td>SHT_NULL</td>
<td>索引为 0 的节</td>
</tr>
<tr>
<td>SHT_PROGBITS</td>
<td>程序数据，如代码、数据等</td>
</tr>
<tr>
<td>SHT_NOBITS</td>
<td>未初始化或初始化为零的数据，该节不占用ELF文件空间，但有大小</td>
</tr>
<tr>
<td>SHT_SYMTAB</td>
<td>符号节</td>
</tr>
<tr>
<td>SHT_STRTAB</td>
<td>字符串节</td>
</tr>
<tr>
<td>SHT_REL</td>
<td>REL 重定位节（32位）</td>
</tr>
<tr>
<td>SHT_RELA</td>
<td>RELA 重定位节（64位）</td>
</tr>
<tr>
<td>SHT_GROUP</td>
<td>组节</td>
</tr>
</tbody></table>
<h5 id="sh-flags"><a href="#sh-flags" class="headerlink" title="sh_flags"></a><strong>sh_flags</strong></h5><p>节的标志位可以组合，描述了节的属性，定义如下：</p>
<table>
<thead>
<tr>
<th>节标志</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>SHF_WRITE</td>
<td>可写</td>
</tr>
<tr>
<td>SHF_ALLOC</td>
<td>执行时驻留内存（这种节一般包含在段内）</td>
</tr>
<tr>
<td>SHF_EXECINSTR</td>
<td>可执行</td>
</tr>
<tr>
<td>SHF_MERGE</td>
<td>可能被合并</td>
</tr>
<tr>
<td>SHF_STRINGS</td>
<td>包含以 0 结尾的字符串</td>
</tr>
<tr>
<td>SHF_INFO_LINK</td>
<td>sh_info 关联了另一个节的索引</td>
</tr>
<tr>
<td>SHF_GROUP</td>
<td>此节是个组节的成员</td>
</tr>
<tr>
<td>SHF_TLS</td>
<td>节包含了线程局部存储（TLS）数据</td>
</tr>
</tbody></table>
<h5 id="sh-addr"><a href="#sh-addr" class="headerlink" title="sh_addr"></a><strong>sh_addr</strong></h5><p>节的虚拟地址，对于 ET_REL 一般都为0。</p>
<h5 id="sh-offset"><a href="#sh-offset" class="headerlink" title="sh_offset"></a><strong>sh_offset</strong></h5><p>节的文件偏移。</p>
<h5 id="sh-size"><a href="#sh-size" class="headerlink" title="sh_size"></a><strong>sh_size</strong></h5><p>节的大小。</p>
<h5 id="sh-link"><a href="#sh-link" class="headerlink" title="sh_link"></a><strong>sh_link</strong></h5><p>关联到其它节（不同节代表不同的意义，后面会有介绍）。</p>
<h5 id="sh-info"><a href="#sh-info" class="headerlink" title="sh_info"></a><strong>sh_info</strong></h5><p>附加的节信息（不同节代表不同的意义，后面会有介绍）。</p>
<h5 id="sh-addralign"><a href="#sh-addralign" class="headerlink" title="sh_addralign"></a><strong>sh_addralign</strong></h5><p>地址对齐。</p>
<h5 id="sh-entsize"><a href="#sh-entsize" class="headerlink" title="sh_entsize"></a><strong>sh_entsize</strong></h5><p>如果节内容是特定元素的数组，该值代表了元素大小，如对于 SHT_SYMTAB，该址为的大小为sizeof(Elf_Sym)。</p>
<p>各个节类型的 sh_info 与 sh_link 的意义如下：</p>
<table>
<thead>
<tr>
<th>节类型</th>
<th>sh_info</th>
<th>sh_link</th>
</tr>
</thead>
<tbody><tr>
<td>SHT_SYMTAB &#x2F; SHT_DYNSYM</td>
<td>全局符号的起始索引</td>
<td>（静态&#x2F;动态）字符串节索引</td>
</tr>
<tr>
<td>SHT_REL &#x2F; SHT_RELA</td>
<td>被重定位的节的索引</td>
<td>（静态&#x2F;动态）符号节索引</td>
</tr>
<tr>
<td>SHT_DYNAMIC</td>
<td>无</td>
<td>动态字符串节索引</td>
</tr>
<tr>
<td>SHT_GNU_versym</td>
<td>无</td>
<td>动态符号节索引</td>
</tr>
<tr>
<td>SHT_GNU_verneed</td>
<td>Verneed 项的数量</td>
<td>动态字符串节索引</td>
</tr>
<tr>
<td>SHT_GNU_verdef</td>
<td>Verdef 项的数量</td>
<td>动态字符串节索引</td>
</tr>
<tr>
<td>SHT_HASH &#x2F; SHT_GNU_HASH</td>
<td>无</td>
<td>动态符号节索引</td>
</tr>
</tbody></table>
<h4 id="符号节与字符串节"><a href="#符号节与字符串节" class="headerlink" title="符号节与字符串节"></a><strong>符号节与字符串节</strong></h4><p>符号节分静态符号节（ST_SYMTAB）与动态符号节（SHT_DYNSYM），可以通过枚举节表得到。每种符号节在一个 ELF 文件中只存在一个，动态符号节只在 ET_EXEC 和 ET_DYN 类型的 ELF 中存在，不会在 ET_REL 类型的 ELF 中出现。</p>
<p>符号节中包含了 Elf_Sym 类型的符号表，Elf_Sym 的定义如下：</p>
<p>32位定义：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  Elf32_Word	st_name;		/* Symbol name (string tbl index) */</span><br><span class="line">  Elf32_Addr	st_value;		/* Symbol value */</span><br><span class="line">  Elf32_Word	st_size;		/* Symbol size */</span><br><span class="line">  unsigned char	st_info;		/* Symbol type and binding */</span><br><span class="line">  unsigned char	st_other;		/* Symbol visibility */</span><br><span class="line">  Elf32_Section	st_shndx;		/* Section index */</span><br><span class="line">&#125; Elf32_Sym;</span><br></pre></td></tr></table></figure>
<p>64位定义：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">typedef struct</span><br><span class="line">&#123;</span><br><span class="line">  Elf64_Word	st_name;		/* Symbol name (string tbl index) */</span><br><span class="line">  unsigned char	st_info;		/* Symbol type and binding */</span><br><span class="line">  unsigned char st_other;		/* Symbol visibility */</span><br><span class="line">  Elf64_Section	st_shndx;		/* Section index */</span><br><span class="line">  Elf64_Addr	st_value;		/* Symbol value */</span><br><span class="line">  Elf64_Xword	st_size;		/* Symbol size */</span><br><span class="line">&#125; Elf64_Sym;</span><br></pre></td></tr></table></figure>
<p><strong>st_name</strong><br>符号名，该值为符号节所关联的字符串节的字符串索引。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//  uint8_t* 	elf_data;</span><br><span class="line">//  Elf_Shdr* 	sym_sect;</span><br><span class="line">//	Elf_Sym* 	sym;</span><br><span class="line">const char*	strtab = (const char*)(elf_data +</span><br><span class="line">	shdr[sym_sect-&gt;sh_link].sh_off);</span><br><span class="line">const char* sym_name = strtab + sym-&gt;st_name;</span><br></pre></td></tr></table></figure>
<p><strong>st_info</strong><br>符号信息，描述了符号类型与符号绑定信息。</p>
<p>符号类型可以通过 ELF_ST_TYPE(st_info) 获取，符号类型的定义如下：</p>
<table>
<thead>
<tr>
<th>符号类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>STT_NOTYPE</td>
<td>未定义符号</td>
</tr>
<tr>
<td>STT_OBJECT</td>
<td>符号是数据</td>
</tr>
<tr>
<td>STT_FUNC</td>
<td>符号是函数</td>
</tr>
<tr>
<td>STT_SECTION</td>
<td>节符号，每个节都会有一个节符号</td>
</tr>
<tr>
<td>STT_FILE</td>
<td>符号名是源文件的文件名，如 .&#x2F;..&#x2F;..&#x2F;test.c</td>
</tr>
<tr>
<td>STT_COMMON</td>
<td>符号是公共数据</td>
</tr>
<tr>
<td>STT_TLS</td>
<td>符号是 TLS 数据</td>
</tr>
<tr>
<td>符号绑定可以通过 ELF_ST_BIND(st_info) 获取，符号绑定的定义如下：</td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>绑定类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>STB_LOCAL</td>
<td>局部符号，对其它文件不可见（如被static修饰的函数）</td>
</tr>
<tr>
<td>STB_GLOBAL</td>
<td>全局符号</td>
</tr>
<tr>
<td>STB_WEAK</td>
<td>弱符号（允许符号找不到）</td>
</tr>
<tr>
<td><strong>st_other</strong></td>
<td></td>
</tr>
<tr>
<td>描述了符号的可见性，定义如下：</td>
<td></td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th>可见类型</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>STV_DEFAULT</td>
<td>默认的可见性</td>
</tr>
<tr>
<td>STV_INTERNAL</td>
<td>处理器定义的隐藏类</td>
</tr>
<tr>
<td>STV_HIDDEN</td>
<td>符号对其它模块隐藏</td>
</tr>
<tr>
<td>STV_PROTECTED</td>
<td>符号不导出</td>
</tr>
<tr>
<td>STV_INTERNAL 和 STV_PROTECTED 是很少见的（至少笔者没有见过），对于SO库（ET_DYN）来说，符号是否导出，不是通过遍历符号表，而是通过查找哈希表，再检查符号类型，后续章节会介绍哈希表。</td>
<td></td>
</tr>
</tbody></table>
<p>**st_shndx **<br>符号所在节的节索引，还有一些特殊定义：</p>
<table>
<thead>
<tr>
<th>节索引</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>SHN_UNDEF</td>
<td>未定义符号，可能存在其它文件或模块中</td>
</tr>
<tr>
<td>SHN_LORESERVE</td>
<td>小于该值且不为SHN_UNDEF，则代表真正的节索引，否则均为特殊索引</td>
</tr>
<tr>
<td>SHN_ABS</td>
<td>绝对符号，只是描述一些信息，如对于STT_FILE 类型的符号</td>
</tr>
<tr>
<td><strong>st_value</strong></td>
<td></td>
</tr>
<tr>
<td>符号的地址</td>
<td></td>
</tr>
</tbody></table>
<p><strong>st_size</strong><br>符号大小</p>
<h2 id="3-ELF的特性"><a href="#3-ELF的特性" class="headerlink" title="3 ELF的特性"></a>3 ELF的特性</h2><h3 id="3-1平台相关"><a href="#3-1平台相关" class="headerlink" title="3.1平台相关"></a>3.1平台相关</h3><p>在ELF 文件头中包含了足够的平台相关信息，如数据编码方式，平台位数，硬件平台e_machine等，这些平台相关信息可在编译由编译器决定。例如，与平台位数的相关的数据结构的定义在elf.h的头文件中．在编译预处理时确定：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">#if ELF CLASS==ELFCLASS32</span><br><span class="line"></span><br><span class="line">extern Elf32_Dyn_DYNAMIC[];</span><br><span class="line"></span><br><span class="line">#define elfhdr elf32_hdr;</span><br><span class="line"></span><br><span class="line">#define elf_phdr elf32_phdr;</span><br><span class="line"></span><br><span class="line">#define elf_note elf32_note;</span><br><span class="line"></span><br><span class="line">#else</span><br><span class="line"></span><br><span class="line">extern Elf64_Dyn_DYNAMIC[];</span><br><span class="line"></span><br><span class="line">#define elfhdr elf64_hdr;</span><br><span class="line"></span><br><span class="line">#define elf_phdr elf64_phdr;</span><br><span class="line"></span><br><span class="line">#define elf_note elf64_note;</span><br><span class="line"></span><br><span class="line">#endif</span><br></pre></td></tr></table></figure>
<p>linux系统加载ELF可执行文件时，必须首先做一些简单的一致性检查．其代码如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">if(memcmp(elf_ex.e_ident,ELFMAG,SELFMAG)!=0)</span><br><span class="line"></span><br><span class="line">goto out; //检查文件头开始四个字符是否为ELF魔数&#x27;\0177ELF</span><br><span class="line"></span><br><span class="line">if(elf_ex.e_type!=ET_EXEC&amp;&amp;elf_ex.e_type!=ET_DYN)</span><br><span class="line"></span><br><span class="line">goto out;//检查文件类型是否为可执行文件或共享目标文件</span><br><span class="line"></span><br><span class="line">if(!elf_check_arch(&amp;elf_ex))</span><br><span class="line"></span><br><span class="line">goto out;//检查硬件平台是否一致</span><br></pre></td></tr></table></figure>
<p>其中的elf_check_arch(x)在不同的硬件平台上有不同的定义，其由系统的硬件平台决定。这样，在硬件平台相同的系统上，ELF可以不作修改的执行。因此，它可以支持不同平台上的交叉编译(cross_compilation)和交叉链接(cross_linking)。</p>
<h3 id="3-2-PIC"><a href="#3-2-PIC" class="headerlink" title="3.2 PIC"></a>3.2 PIC</h3><p>ELF可以生成一种特殊的代码——与位置无关的代码(position-independent code,PIC)。用户对gcc使用-fPIC指示GNU编译系统生成PIC代码。它是实现共享库或共享可执行代码的基础．这种代码的特殊性在于它可以加载到内存地址空间的任何地址执行．这也是加载器可以很方便的在进程中动态链接共享库。</p>
<p>PIC的实现运用了一个事实，就是代码段中任何指令和数据段中的任何变量之间的距离都是一个与代码段和数据段的绝对存储器位置无关的常量。因此，编译器在数据段开始的地方创建了一个表．叫做全局偏移量表(global offset table．GOT)。GOT包含每个被这个目标模块引用的全局数据目标的表目。编译器还为GOT中每个表目生成一个重定位记录。在加载时，动态链接器会重定位GOT中的每个表目，使得它包含正确的绝对地址。PIC代码在代码中实现通过GOT间接的引用每个全局变量，这样，代码中本来简单的数据引用就变得复杂，必须加入得到GOT适当表目内容的指令。对只读数据的引用也根据同样的道理，所以，加上 IC编译成的代码比一般的代码开销大。</p>
<p>如果一个elf可执行文件需要调用定义在共享库中的任何函数，那么它就有自己的GOT和PLT(procedure linkage table，过程链接表)．这两个节之间的交互可以实现延迟绑定(lazy binging)，这种方法将过程地址的绑定推迟到第一次调用该函数。为了实现延迟绑定，GOT的头三条表目是特殊的：GOT[0]包含.dynamic 段的地址，.dynamic段包含了动态链接器用来绑定过程地址的信息，比如符号的位置和重定位信息;GOT[1]包含动态链接器的标识;GOT[2]包含动态链接器的延迟绑定代码的入口点。GOT的其他表目为本模块要引用的一个全局变量或函数的地址。PLT是一个以16字节(32位平台中)表目的数组形式出现的代码序列。其中PLT[0]是一个特殊的表目，它跳转到动态链接器中执行;每个定义在共享库中并被本模块调用的函数在PLT中都有一个表目，从 PLT[1]开始．模块对函数的调用会转到相应PLT表目中执行，这些表目由三条指令构成。第一条指令是跳转到相应的GOT存储的地址值中．第二条指令把函数相应的ID压入栈中，第三条指令跳转到PLT[O]中调用动态链接器解析函数地址，并把函数真正地址存入相应的GOT表目中。被调用函数GOT相应表目中存储的最初地址为相应PLT表目中第二条指令的地址值，函数第一次被调用后．GOT表目中的值就为函数的真正地址。因此，第一次调用函数时开销比较大．但是其后的每次调用都只会花费一条指令和一个间接的存储器引用。</p>
<h3 id="3-3-强大的工具支持"><a href="#3-3-强大的工具支持" class="headerlink" title="3.3 强大的工具支持"></a>3.3 强大的工具支持</h3><p>由于gnu有大量的工具支持elf文件格式．随着gnu工具的功能的扩展．程序员对ELF文件的运用也越来越灵活。例如，在C++中全局的构造函数和析构函数必须非常小心的处理碰到的语言规范问题。构造函数必须在main函数之前被调用。析构函数必须在main函数返回之后被调用。ELF文件格式中，定义了两个特殊的节 (section)，.init和.fini，.init保存着可执行指令，它构成了进程的初始化代码。当一个程序开始运行时，在main函数被调用之前 (c语言称为main)，系统安排执行这个section的中的代码。.fini保存着可执行指令，它构成了进程的终止代码。当一个程序正常退出时．系统安排执行这个section的中的代码。C++编译器利用这个特性．构造正确的.init和.fini sections．并结合.ctors(该section保存着程序的全局的构造函数的指针数组)和.dtors(该section保存着程序的全局的析构函数的指针数组)两个section，完成全局的构造函数和析构函数的处理。</p>
<p>GCC还有许多扩展的特性．有些对ELF 特别的有用。其中一个就是_attribute_ 。使用_attribute_可以使一个函数放到_CTOR_LIST_或者_DTOR_LIST_里。 <em>attribute</em>((constructor))促使函数在进入main之前会被自动调用。<em>attribute</em>((destructor))促使函数在main返回或者exit调用之后被自动调用。这种函数必须是不能带参数的而且必须是static void类型的函数。在ELF下，这个特性在一般的可执行文件和共享库中都能很好的工作。另外一个GCC的特性是 attribute_(section(“sectionname”))，使用这个，能把一个函数或者是数据结构放到任何的section中。</p>
<p>[举例]</p>
<p>这里，通过使用一些用于操作ELF文件的工具的例子，来对其有一个直观的了解。</p>
<p>1 readelf工具</p>
<p>readelf用来显示ELF格式目标文件的信息.可通过参数选项来控制显示哪些特定信息。</p>
<p>*读取elf文件头信息：</p>
<p><code> $ readelf -h fbtest</code></p>
<p>输入之后，输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">ELF Header:</span><br><span class="line"></span><br><span class="line">Magic:   7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00</span><br><span class="line"></span><br><span class="line">Class:                             ELF32</span><br><span class="line"></span><br><span class="line">Data:                              2&#x27;s complement, little endian</span><br><span class="line"></span><br><span class="line">Version:                           1 (current)</span><br><span class="line"></span><br><span class="line">OS/ABI:                            UNIX - System V</span><br><span class="line"></span><br><span class="line">ABI Version:                       0</span><br><span class="line"></span><br><span class="line">Type:                              EXEC (Executable file)</span><br><span class="line"></span><br><span class="line">Machine:                           Intel 80386</span><br><span class="line"></span><br><span class="line">Version:                           0x1</span><br><span class="line"></span><br><span class="line">Entry point address:               0x80484d0</span><br><span class="line"></span><br><span class="line">Start of program headers:          52 (bytes into file)</span><br><span class="line"></span><br><span class="line">Start of section headers:          5924 (bytes into file)</span><br><span class="line"></span><br><span class="line">Flags:                             0x0</span><br><span class="line"></span><br><span class="line">Size of this header:               52 (bytes)</span><br><span class="line"></span><br><span class="line">Size of program headers:           32 (bytes)</span><br><span class="line"></span><br><span class="line">Number of program headers:         8</span><br><span class="line"></span><br><span class="line">Size of section headers:           40 (bytes)</span><br><span class="line"></span><br><span class="line">Number of section headers:         36</span><br><span class="line"></span><br><span class="line">Section header string table index: 33</span><br></pre></td></tr></table></figure>
<p>这里，fbtest是在本地使用gcc编译生成的一个简单的可执行程序。</p>
<p>*查看elf文件程序头表信息：</p>
<p><code>$readelf -l fbtest</code></p>
<p>输入之后，输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Program Headers:</span><br><span class="line"></span><br><span class="line">Type           Offset   VirtAddr   PhysAddr   FileSiz MemSiz  Flg Align</span><br><span class="line"></span><br><span class="line">PHDR           0x000034 0x08048034 0x08048034 0x00100 0x00100 R E 0x4</span><br><span class="line"></span><br><span class="line">INTERP         0x000134 0x08048134 0x08048134 0x00013 0x00013 R   0x1</span><br><span class="line"></span><br><span class="line">[Requesting program interpreter: /lib/ld-linux.so.2]</span><br><span class="line"></span><br><span class="line">LOAD           0x000000 0x08048000 0x08048000 0x00df4 0x00df4 R E 0x1000</span><br><span class="line"></span><br><span class="line">LOAD           0x000f0c 0x08049f0c 0x08049f0c 0x00128 0x00178 RW  0x1000</span><br><span class="line"></span><br><span class="line">DYNAMIC        0x000f20 0x08049f20 0x08049f20 0x000d0 0x000d0 RW  0x4</span><br><span class="line"></span><br><span class="line">NOTE           0x000148 0x08048148 0x08048148 0x00020 0x00020 R   0x4</span><br><span class="line"></span><br><span class="line">GNU_STACK      0x000000 0x00000000 0x00000000 0x00000 0x00000 RW  0x4</span><br><span class="line"></span><br><span class="line">GNU_RELRO      0x000f0c 0x08049f0c 0x08049f0c 0x000f4 0x000f4 R   0x1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Section to Segment mapping:</span><br><span class="line"></span><br><span class="line">Segment Sections...</span><br><span class="line"></span><br><span class="line">00</span><br><span class="line"></span><br><span class="line">01     .interp</span><br><span class="line"></span><br><span class="line">02     .interp .note.ABI-tag .hash .gnu.hash .dynsym .dynstr .gnu.version .gnu.version_r .rel.dyn .rel.plt .init .plt .text .fini .rodata .eh_frame</span><br><span class="line"></span><br><span class="line">03     .ctors .dtors .jcr .dynamic .got .got.plt .data .bss</span><br><span class="line"></span><br><span class="line">04     .dynamic</span><br><span class="line"></span><br><span class="line">05     .note.ABI-tag</span><br><span class="line"></span><br><span class="line">06</span><br><span class="line"></span><br><span class="line">07     .ctors .dtors .jcr .dynamic .got</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>*查看elf文件的节信息：</p>
<p><code> $readelf -S libmy.so</code></p>
<p>输入之后，输出如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">There are 33 section headers, starting at offset 0xfd0:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Section Headers:</span><br><span class="line"></span><br><span class="line">[Nr] Name              Type            Addr     Off    Size   ES Flg Lk Inf Al</span><br><span class="line"></span><br><span class="line">[ 0]                   NULL            00000000 000000 000000 00      0   0  0</span><br><span class="line"></span><br><span class="line">[ 1] .hash             HASH            000000d4 0000d4 0000a0 04   A  3   0  4</span><br><span class="line"></span><br><span class="line">[ 2] .gnu.hash         GNU_HASH        00000174 000174 000040 04   A  3   0  4</span><br><span class="line"></span><br><span class="line">[ 3] .dynsym           DYNSYM          000001b4 0001b4 000150 10   A  4   1  4</span><br><span class="line"></span><br><span class="line">[ 4] .dynstr           STRTAB          00000304 000304 00018a 00   A  0   0  1</span><br><span class="line"></span><br><span class="line">[ 5] .gnu.version      VERSYM          0000048e 00048e 00002a 02   A  3   0  2</span><br><span class="line"></span><br><span class="line">[ 6] .gnu.version_r    VERNEED         000004b8 0004b8 000020 00   A  4   1  4</span><br><span class="line"></span><br><span class="line">[ 7] .rel.dyn          REL             000004d8 0004d8 0000e8 08   A  3   0  4</span><br><span class="line"></span><br><span class="line">[ 8] .rel.plt          REL             000005c0 0005c0 000010 08   A  3  10  4</span><br><span class="line"></span><br><span class="line">[ 9] .init             PROGBITS        000005d0 0005d0 000030 00  AX  0   0  4</span><br><span class="line"></span><br><span class="line">[10] .plt              PROGBITS        00000600 000600 000030 04  AX  0   0  4</span><br><span class="line"></span><br><span class="line">[11] .text             PROGBITS        00000630 000630 0002a4 00  AX  0   0 16</span><br><span class="line"></span><br><span class="line">[12] .fini             PROGBITS        000008d4 0008d4 00001c 00  AX  0   0  4</span><br><span class="line"></span><br><span class="line">[13] .rodata           PROGBITS        000008f0 0008f0 000006 00   A  0   0  1</span><br><span class="line"></span><br><span class="line">[14] .eh_frame_hdr     PROGBITS        000008f8 0008f8 000034 00   A  0   0  4</span><br><span class="line"></span><br><span class="line">[15] .eh_frame         PROGBITS        0000092c 00092c 0000d8 00   A  0   0  4</span><br><span class="line"></span><br><span class="line">[16] .ctors            PROGBITS        00001a04 000a04 00000c 00  WA  0   0  4</span><br><span class="line"></span><br><span class="line">[17] .dtors            PROGBITS        00001a10 000a10 000008 00  WA  0   0  4</span><br><span class="line"></span><br><span class="line">[18] .jcr              PROGBITS        00001a18 000a18 000004 00  WA  0   0  4</span><br><span class="line"></span><br><span class="line">[19] .dynamic          DYNAMIC         00001a1c 000a1c 0000d0 08  WA  4   0  4</span><br><span class="line"></span><br><span class="line">[20] .got              PROGBITS        00001aec 000aec 00000c 04  WA  0   0  4</span><br><span class="line"></span><br><span class="line">[21] .got.plt          PROGBITS        00001af8 000af8 000014 04  WA  0   0  4</span><br><span class="line"></span><br><span class="line">[22] .data             PROGBITS        00001b0c 000b0c 000008 00  WA  0   0  4</span><br><span class="line"></span><br><span class="line">[23] .bss              NOBITS          00001b14 000b14 000008 00  WA  0   0  4</span><br><span class="line"></span><br><span class="line">[24] .comment          PROGBITS        00000000 000b14 0000d2 00      0   0  1</span><br><span class="line"></span><br><span class="line">[25] .debug_aranges    PROGBITS        00000000 000be8 000050 00      0   0  8</span><br><span class="line"></span><br><span class="line">[26] .debug_info       PROGBITS        00000000 000c38 00011a 00      0   0  1</span><br><span class="line"></span><br><span class="line">[27] .debug_abbrev     PROGBITS        00000000 000d52 000024 00      0   0  1</span><br><span class="line"></span><br><span class="line">[28] .debug_line       PROGBITS        00000000 000d76 000102 00      0   0  1</span><br><span class="line"></span><br><span class="line">[29] .debug_ranges     PROGBITS        00000000 000e78 000040 00      0   0  8</span><br><span class="line"></span><br><span class="line">[30] .shstrtab         STRTAB          00000000 000eb8 000116 00      0   0  1</span><br><span class="line"></span><br><span class="line">[31] .symtab           SYMTAB          00000000 0014f8 0004c0 10     32  56  4</span><br><span class="line"></span><br><span class="line">[32] .strtab           STRTAB          00000000 0019b8 00031c 00      0   0  1</span><br><span class="line"></span><br><span class="line">Key to Flags:</span><br><span class="line"></span><br><span class="line">W (write), A (alloc), X (execute), M (merge), S (strings)</span><br><span class="line"></span><br><span class="line">I (info), L (link order), G (group), x (unknown)</span><br><span class="line"></span><br><span class="line">O (extra OS processing required) o (OS specific), p (processor specific)</span><br></pre></td></tr></table></figure>
<p>这里的libmy.so是自行生成的一个共享库。</p>
<p>2 objcopy工具</p>
<p>objcopy可以把一种目标文件中的内容复制到另一种类型的目标文件中.</p>
<p>通过objcopy的各种选项，可以对目标文件进行各种类型的操作。例如去掉可执行文件的调试信息（效果等同于strip）等等，具体需要做什么操作，要求我们对elf文件中每个部分的内容有所理解。</p>
<p>这里只给出一个例子：</p>
<p>*使用objcopy把.comment段和.note段的信息去掉：</p>
<p><code>$ objcopy -R .comment -R .note hello hello.min</code></p>
<p>这里，hello是一个可执行文件，通过”readelf -l hello”或者”readelf -S hello”命令可以知道文件中包含一个.note段和.comment段，通过这个命令，将这两个段从文件中删除，不会改变原来的文件，而是将删除了这些信息的文件存放在hello.min中。实际通过这个方法，可以减少可执行文件的大小，且不影响可执行文件的功能。</p>
<p>项的含义是：</p>
<p>-R .note -R .comment 表示移掉 .note 与 .comment 段</p>
<p>-O binary xyb xyb.bin 表示由xyb生成二进制文件xyb.bin</p>
<p>3 objdump工具</p>
<p>objdump是用查看目标文件或者可执行的目标文件的构成的GCC工具。</p>
<p>以下给出几个常用的例子：</p>
<p>*输出目标文件的所有段概括:</p>
<p><code> # objdump -h main</code></p>
<p>输入之后，输出信息大致如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">main:     file format elf32-i386</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Sections:</span><br><span class="line"></span><br><span class="line">Idx Name          Size      VMA       LMA       File off  Algn</span><br><span class="line"></span><br><span class="line">0 .interp       00000013  08048134  08048134  00000134  2**0</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line"></span><br><span class="line">1 .note.ABI-tag 00000020  08048148  08048148  00000148  2**2</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line"></span><br><span class="line">2 .gnu.hash     00000030  08048168  08048168  00000168  2**2</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line"></span><br><span class="line">3 .dynsym       000000d0  08048198  08048198  00000198  2**2</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line"></span><br><span class="line">4 .dynstr       00000183  08048268  08048268  00000268  2**0</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line"></span><br><span class="line">5 .gnu.version  0000001a  080483ec  080483ec  000003ec  2**1</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line"></span><br><span class="line">6 .gnu.version_r 00000060  08048408  08048408  00000408  2**2</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line"></span><br><span class="line">7 .rel.dyn      00000010  08048468  08048468  00000468  2**2</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line"></span><br><span class="line">8 .rel.plt      00000048  08048478  08048478  00000478  2**2</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line"></span><br><span class="line">9 .init         00000017  080484c0  080484c0  000004c0  2**2</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, CODE</span><br><span class="line"></span><br><span class="line">10 .plt          000000a0  080484d8  080484d8  000004d8  2**2</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, CODE</span><br><span class="line"></span><br><span class="line">11 .text         00000238  08048580  08048580  00000580  2**4</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, CODE</span><br><span class="line"></span><br><span class="line">12 .fini         0000001c  080487b8  080487b8  000007b8  2**2</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, CODE</span><br><span class="line"></span><br><span class="line">13 .rodata       00000013  080487d4  080487d4  000007d4  2**2</span><br></pre></td></tr></table></figure>
<p>……其余内容省略……</p>
<p>这里,main是一个可执行文件。</p>
<p>*输出目标文件的符号表:</p>
<p><code># objdump -t main</code></p>
<p>输入之后，输出类似如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line">main:     file format elf32-i386</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">SYMBOL TABLE:</span><br><span class="line"></span><br><span class="line">08048134 l    d  .interp        00000000              .interp</span><br><span class="line"></span><br><span class="line">08048148 l    d  .note.ABI-tag  00000000              .note.ABI-tag</span><br><span class="line"></span><br><span class="line">08048168 l    d  .gnu.hash      00000000              .gnu.hash</span><br><span class="line"></span><br><span class="line">08048198 l    d  .dynsym        00000000              .dynsym</span><br><span class="line"></span><br><span class="line">08048268 l    d  .dynstr        00000000              .dynstr</span><br><span class="line"></span><br><span class="line">080483ec l    d  .gnu.version   00000000              .gnu.version</span><br><span class="line"></span><br><span class="line">08048408 l    d  .gnu.version_r 00000000              .gnu.version_r</span><br><span class="line"></span><br><span class="line">08048468 l    d  .rel.dyn       00000000              .rel.dyn</span><br><span class="line"></span><br><span class="line">08048478 l    d  .rel.plt       00000000              .rel.plt</span><br><span class="line"></span><br><span class="line">080484c0 l    d  .init  00000000              .init</span><br><span class="line"></span><br><span class="line">080484d8 l    d  .plt   00000000              .plt</span><br><span class="line"></span><br><span class="line">08048580 l    d  .text  00000000              .text</span><br><span class="line"></span><br><span class="line">080487b8 l    d  .fini  00000000              .fini</span><br><span class="line"></span><br><span class="line">080487d4 l    d  .rodata        00000000              .rodata</span><br><span class="line"></span><br><span class="line">080487e8 l    d  .eh_frame_hdr  00000000              .eh_frame_hdr</span><br><span class="line"></span><br><span class="line">08048824 l    d  .eh_frame      00000000              .eh_frame</span><br><span class="line"></span><br><span class="line">08049914 l    d  .ctors 00000000              .ctors</span><br><span class="line"></span><br><span class="line">08049920 l    d  .dtors 00000000              .dtors</span><br><span class="line"></span><br><span class="line">08049928 l    d  .jcr   00000000              .jcr</span><br><span class="line"></span><br><span class="line">0804992c l    d  .dynamic       00000000              .dynamic</span><br><span class="line"></span><br><span class="line">08049a0c l    d  .got   00000000              .got</span><br><span class="line"></span><br><span class="line">08049a10 l    d  .got.plt       00000000              .got.plt</span><br><span class="line"></span><br><span class="line">08049a40 l    d  .data  00000000              .data</span><br><span class="line"></span><br><span class="line">08049a48 l    d  .bss   00000000              .bss</span><br><span class="line"></span><br><span class="line">00000000 l    d  .comment       00000000              .comment</span><br><span class="line"></span><br><span class="line">080485a4 l     F .text  00000000              call_gmon_start</span><br><span class="line"></span><br><span class="line">00000000 l    df *ABS*  00000000              crtstuff.c</span><br><span class="line"></span><br><span class="line">08049914 l     O .ctors 00000000              __CTOR_LIST__</span><br><span class="line"></span><br><span class="line">08049920 l     O .dtors 00000000              __DTOR_LIST__</span><br><span class="line"></span><br><span class="line">08049928 l     O .jcr   00000000              __JCR_LIST__</span><br><span class="line"></span><br><span class="line">08049ad4 l     O .bss   00000004              dtor_idx.5793</span><br><span class="line"></span><br><span class="line">08049ad8 l     O .bss   00000001              completed.5791</span><br><span class="line"></span><br><span class="line">080485d0 l     F .text  00000000              __do_global_dtors_aux</span><br></pre></td></tr></table></figure>
<p>……其余信息省略……</p>
<p>*以某种分类信息的形式把目标文件的数据组织（被分为几大块）输出  ：</p>
<p><code># objdump -x main</code></p>
<p>输入之后，输出信息类似如下：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line">main:     file format elf32-i386</span><br><span class="line"></span><br><span class="line">main</span><br><span class="line"></span><br><span class="line">architecture: i386, flags 0x00000112:</span><br><span class="line"></span><br><span class="line">EXEC_P, HAS_SYMS, D_PAGED</span><br><span class="line"></span><br><span class="line">start address 0x08048580</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Program Header:</span><br><span class="line"></span><br><span class="line">PHDR off    0x00000034 vaddr 0x08048034 paddr 0x08048034 align 2**2</span><br><span class="line"></span><br><span class="line">filesz 0x00000100 memsz 0x00000100 flags r-x</span><br><span class="line"></span><br><span class="line">INTERP off    0x00000134 vaddr 0x08048134 paddr 0x08048134 align 2**0</span><br><span class="line"></span><br><span class="line">filesz 0x00000013 memsz 0x00000013 flags r--</span><br><span class="line"></span><br><span class="line">LOAD off    0x00000000 vaddr 0x08048000 paddr 0x08048000 align 2**12</span><br><span class="line"></span><br><span class="line">filesz 0x00000914 memsz 0x00000914 flags r-x</span><br><span class="line"></span><br><span class="line">LOAD off    0x00000914 vaddr 0x08049914 paddr 0x08049914 align 2**12</span><br><span class="line"></span><br><span class="line">filesz 0x00000130 memsz 0x000001cc flags rw-</span><br><span class="line"></span><br><span class="line">DYNAMIC off    0x0000092c vaddr 0x0804992c paddr 0x0804992c align 2**2</span><br><span class="line"></span><br><span class="line">filesz 0x000000e0 memsz 0x000000e0 flags rw-</span><br><span class="line"></span><br><span class="line">NOTE off    0x00000148 vaddr 0x08048148 paddr 0x08048148 align 2**2</span><br><span class="line"></span><br><span class="line">filesz 0x00000020 memsz 0x00000020 flags r--</span><br><span class="line"></span><br><span class="line">EH_FRAME off    0x000007e8 vaddr 0x080487e8 paddr 0x080487e8 align 2**2</span><br><span class="line"></span><br><span class="line">filesz 0x0000003c memsz 0x0000003c flags r--</span><br><span class="line"></span><br><span class="line">STACK off    0x00000000 vaddr 0x00000000 paddr 0x00000000 align 2**2</span><br><span class="line"></span><br><span class="line">...省略...</span><br><span class="line"></span><br><span class="line">Dynamic Section:</span><br><span class="line"></span><br><span class="line">NEEDED      libstdc++.so.6</span><br><span class="line"></span><br><span class="line">NEEDED      libm.so.6</span><br><span class="line"></span><br><span class="line">NEEDED      libgcc_s.so.1</span><br><span class="line"></span><br><span class="line">NEEDED      libc.so.6</span><br><span class="line"></span><br><span class="line">INIT        0x80484c0</span><br><span class="line"></span><br><span class="line">FINI        0x80487b8</span><br><span class="line"></span><br><span class="line">GNU_HASH    0x8048168</span><br><span class="line"></span><br><span class="line">...省略...</span><br><span class="line"></span><br><span class="line">Version References:</span><br><span class="line"></span><br><span class="line">required from libstdc++.so.6:</span><br><span class="line"></span><br><span class="line">0x056bafd3 0x00 05 CXXABI_1.3</span><br><span class="line"></span><br><span class="line">0x08922974 0x00 03 GLIBCXX_3.4</span><br><span class="line"></span><br><span class="line">required from libc.so.6:</span><br><span class="line"></span><br><span class="line">0x0d696910 0x00 04 GLIBC_2.0</span><br><span class="line"></span><br><span class="line">0x09691f73 0x00 02 GLIBC_2.1.3</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Sections:</span><br><span class="line"></span><br><span class="line">Idx Name          Size      VMA       LMA       File off  Algn</span><br><span class="line"></span><br><span class="line">0 .interp       00000013  08048134  08048134  00000134  2**0</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line"></span><br><span class="line">1 .note.ABI-tag 00000020  08048148  08048148  00000148  2**2</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line"></span><br><span class="line">2 .gnu.hash     00000030  08048168  08048168  00000168  2**2</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line"></span><br><span class="line">3 .dynsym       000000d0  08048198  08048198  00000198  2**2</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line"></span><br><span class="line">4 .dynstr       00000183  08048268  08048268  00000268  2**0</span><br><span class="line"></span><br><span class="line">CONTENTS, ALLOC, LOAD, READONLY, DATA</span><br><span class="line"></span><br><span class="line">5 .gnu.version  0000001a  080483ec  080483ec  000003ec  2**1</span><br><span class="line"></span><br><span class="line">...省略...</span><br><span class="line"></span><br><span class="line">SYMBOL TABLE:</span><br><span class="line"></span><br><span class="line">08048134 l    d  .interp        00000000              .interp</span><br><span class="line"></span><br><span class="line">08048148 l    d  .note.ABI-tag  00000000              .note.ABI-tag</span><br><span class="line"></span><br><span class="line">08048168 l    d  .gnu.hash      00000000              .gnu.hash</span><br><span class="line"></span><br><span class="line">08048198 l    d  .dynsym        00000000              .dynsym</span><br><span class="line"></span><br><span class="line">08048268 l    d  .dynstr        00000000              .dynstr</span><br><span class="line"></span><br><span class="line">080483ec l    d  .gnu.version   00000000              .gnu.version</span><br><span class="line"></span><br><span class="line">08048408 l    d  .gnu.version_r 00000000              .gnu.version_r</span><br><span class="line"></span><br><span class="line">...省略...</span><br></pre></td></tr></table></figure>
<p>这里可知，分别显示出各个段相关的信息。</p>
<p>*输出指定段的信息:</p>
<p><code># objdump  -j .text -S  main</code></p>
<p>输入之后，输出类似如下:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">main:     file format elf32-i386</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Disassembly of section .text:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">08048580 &lt;_start&gt;:</span><br><span class="line"></span><br><span class="line">8048580:       31 ed                   xor    %ebp,%ebp</span><br><span class="line"></span><br><span class="line">8048582:       5e                      pop    %esi</span><br><span class="line"></span><br><span class="line">8048583:       89 e1                   mov    %esp,%ecx</span><br><span class="line"></span><br><span class="line">8048585:       83 e4 f0                and    $0xfffffff0,%esp</span><br><span class="line"></span><br><span class="line">8048588:       50                      push   %eax</span><br><span class="line"></span><br><span class="line">8048589:       54                      push   %esp</span><br><span class="line"></span><br><span class="line">...省略...</span><br></pre></td></tr></table></figure>
<p>这里，反汇编会用到类似的命令。</p>
<p>4 nm工具</p>
<p>这个命令可以用来查看库中的符号。</p>
<p>nm列出的符号有很多，常见的有三种，一种是在库中被调用，但并没有在库中定义(表明需要其他库支持)，用U表示；一种是库中定义的函数，用T表示，这是最常见的；另外一种是所谓的“弱态”符号，它们虽然在库中被定义，但是可能被其他库中的同名符号覆盖，用W表示。</p>
<p>*假设开发者希望知道hello库中是否定义了 printf():</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$nm libhello.so |grep printf</span><br><span class="line"></span><br><span class="line">U printf</span><br></pre></td></tr></table></figure>
<p>U表示符号printf被引用，但是并没有在函数内定义，由此可以推断，要正常使用hello库，必须有其它库支持。</p>
<p>5 ldd工具</p>
<p>ldd命令可以用来查看一个可执行文件或者库依赖哪些其他的文件。</p>
<p>*使用ldd命令查看hello依赖于哪些库：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ldd hello</span><br><span class="line"></span><br><span class="line">libc.so.6=&gt;/lib/libc.so.6(0x400la000)</span><br><span class="line"></span><br><span class="line">/lib/ld-linux.so.2=&gt;/lib/ld-linux.so.2 (0x40000000)</span><br></pre></td></tr></table></figure>
<p>这里，结合nm，从上面的结果可以继续查看printf最终在哪里被定义.</p>
<h2 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h2><h3 id="A-readelf使用"><a href="#A-readelf使用" class="headerlink" title="A. readelf使用"></a>A. readelf使用</h3><p>readelf -S 查看节表</p>
<p>readelf -s 查看符号表</p>
<p>readelf -h 查看elf文件头</p>
<p>readelf -l 程序头</p>
<p>readelf -n 查看调试信息表</p>
<p>readelf -w 查看debug相关的表 如wi是debug_info,wl是debug_line</p>

</div>


    <div class="post-guide">
        <div class="item left">
            
              <a href="/2022/10/16/01%20OS/Linux/%E7%BC%96%E8%AF%91%E3%80%81%E9%93%BE%E6%8E%A5%E5%92%8C%E8%A3%85%E8%BD%BD/DSO/">
                  <i class="fa fa-angle-left" aria-hidden="true"></i>
                  DSO(dynamic Shared Object)动态共享对象的原理
              </a>
            
        </div>
        <div class="item right">
            
              <a href="/2022/10/14/01%20OS/Linux/Perf/%E5%8F%82%E8%80%83%E8%B5%84%E6%96%99/">
                参考资料
                <i class="fa fa-angle-right" aria-hidden="true"></i>
              </a>
            
        </div>
    </div>




<script>
	
	
</script>

	</div>
	<div id="footer">
	<p>
	©2022-<span id="footerYear"></span> 
	<a href="/">Leah Ge</a> 
	
	
	<br>
	</p>
</div>
<script type="text/javascript"> 
	document.getElementById('footerYear').innerHTML = new Date().getFullYear() + '';
</script>

	<button id="totop-toggle" class="toggle"><i class="fa fa-angle-double-up" aria-hidden="true"></i></button>
</body>
</html>